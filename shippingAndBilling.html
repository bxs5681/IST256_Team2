<!-- Group Member Tasks:
    Binesh - HTML/CSS/Bootstrap/AngularJS
    Kyle   - JSON Shopper Document collection
    Vedang - jQuery (Search and update the JSON product document)
-->

<!DOCTYPE html>
<html lang="en" ng-app="shippingApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HiTech Store - Shipping & Billing</title>

    <!-- Shared layout + page styles -->
    <link rel="stylesheet" href="Storefront_Page_Layout.css">
    <link rel="stylesheet" href="bootstrap-5.3.8-dist/css/bootstrap.min.css">

    <!-- Libraries -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>

    <!-- Page JS (your existing files) -->
    <script src="shippingValidation.js"></script>
    <script src="billingValidation.js"></script>
    <script src="shippingAndBillingAngular.js"></script>

    <style>
        .form-section {
            background: #ffffff;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        #jsonOutput {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            max-height: 350px;
            overflow-y: auto;
            font-family: "Courier New", monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }

        .field-error {
            border-color: #dc3545 !important;
        }

        .success-banner {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .validation-success {
            color: #28a745;
            font-weight: bold;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.875em;
            margin-top: 5px;
        }

        /* Main header styling inside <main> */
        main h2 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-size: 1.8rem;
        }
    </style>
</head>
<body>

<!-- Header (same as index.html) -->
<header>
    <a href="index.html">
        <img src="Images/HiTech Logo Transparent.png"
             alt="HiTech Store Logo"
             style="height:150px; width:150px; filter:hue-rotate(60deg)">
    </a>
    <div>
        <h1>HiTech Store</h1>
        <p><em>Your one-stop shop for all tech gadgets</em></p>
    </div>
</header>

<!-- Main Layout: nav on the left, main in the center, aside on the right -->
<div class="container" ng-controller="ShippingController">

    <!-- Navigation (same structure as other pages) -->
    <nav>
        <ul style="padding-left: 10px;">
            <li><a href="index.html">Home</a></li>
            <li><a href="signup.html">Login</a></li>
            <li><a href="shopper.html">Shopper Management</a></li>
            <li><a href="products.html">Products</a></li>
            <li><a href="shoppingCart.html">Shopping Cart</a></li>
            <li><a href="handleReturns.html">Returns</a></li>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact Us</a></li>
        </ul>
    </nav>

    <!-- Main Section: Shipping, Billing, JSON -->
    <main>
        <h2>Shipping &amp; Billing</h2>

        <!-- Success Banner - only after successful submission -->
        <div class="success-banner" ng-if="showSuccess">
            <h4>ðŸŽ‰ Order Submitted Successfully!</h4>
            <p>Your order has been processed. Below you can see the complete order JSON document.</p>
            <button class="btn btn-light btn-sm" ng-click="resetForm()">Place Another Order</button>
        </div>

        <!-- If there is no cartSummary (no items in cart) -->
        <div class="form-section" ng-if="!cartSummary">
            <div class="alert alert-warning mb-0">
                <h4>Your cart is empty</h4>
                <p>Please add items to your cart before proceeding with shipping.</p>
                <a href="shoppingCart.html" class="btn btn-primary">Return to Shopping Cart</a>
            </div>
        </div>

        <!-- Shipping Information section (only if cart has items and order not submitted) -->
        <div class="form-section" ng-if="cartSummary && !orderSubmitted">
            <h3>Shipping Information</h3>

            <form name="shippingForm" novalidate>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>Address *</strong></label>
                        <input type="text"
                               class="form-control"
                               id="address"
                               name="address"
                               ng-model="shippingData.address"
                               ng-blur="validateField('address', shippingData.address)"
                               ng-class="{'field-error': hasError('address')}"
                               required>
                        <div class="error-message" ng-if="hasError('address')">
                            {{validationErrors.address}}
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>City *</strong></label>
                        <input type="text"
                               class="form-control"
                               id="city"
                               name="city"
                               ng-model="shippingData.city"
                               ng-blur="validateField('city', shippingData.city)"
                               ng-class="{'field-error': hasError('city')}"
                               required>
                        <div class="error-message" ng-if="hasError('city')">
                            {{validationErrors.city}}
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>State *</strong></label>
                        <input type="text"
                               class="form-control"
                               id="state"
                               name="state"
                               maxlength="2"
                               ng-model="shippingData.state"
                               ng-blur="validateField('state', shippingData.state)"
                               ng-class="{'field-error': hasError('state')}"
                               required>
                        <div class="error-message" ng-if="hasError('state')">
                            {{validationErrors.state}}
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>ZIP Code *</strong></label>
                        <input type="text"
                               class="form-control"
                               id="zipCode"
                               name="zipCode"
                               maxlength="5"
                               ng-model="shippingData.zipCode"
                               ng-blur="validateField('zipCode', shippingData.zipCode)"
                               ng-class="{'field-error': hasError('zipCode')}"
                               required>
                        <div class="error-message" ng-if="hasError('zipCode')">
                            {{validationErrors.zipCode}}
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>Shipping Carrier *</strong></label>
                        <select class="form-select"
                                id="shippingCarrier"
                                name="shippingCarrier"
                                ng-model="shippingData.shippingCarrier"
                                ng-change="calculateShipping(); updateOrderJson()"
                                ng-blur="validateField('shippingCarrier', shippingData.shippingCarrier)"
                                ng-class="{'field-error': hasError('shippingCarrier')}"
                                required>
                            <option value="">-- Select Carrier --</option>
                            <option value="UPS">UPS</option>
                            <option value="FedEx">FedEx</option>
                            <option value="USPS">USPS</option>
                        </select>
                        <div class="error-message" ng-if="hasError('shippingCarrier')">
                            {{validationErrors.shippingCarrier}}
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label"><strong>Shipping Method *</strong></label>
                        <select class="form-select"
                                id="shippingMethod"
                                name="shippingMethod"
                                ng-model="shippingData.shippingMethod"
                                ng-change="calculateShipping(); updateOrderJson()"
                                ng-blur="validateField('shippingMethod', shippingData.shippingMethod)"
                                ng-class="{'field-error': hasError('shippingMethod')}"
                                required>
                            <option value="">-- Select Method --</option>
                            <option value="Standard">Standard</option>
                            <option value="Express">Express</option>
                            <option value="Overnight">Overnight</option>
                        </select>
                        <div class="error-message" ng-if="hasError('shippingMethod')">
                            {{validationErrors.shippingMethod}}
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label"><strong>Special Instructions</strong></label>
                    <textarea class="form-control"
                              id="specialInstructions"
                              rows="3"
                              ng-model="shippingData.specialInstructions"
                              ng-change="updateOrderJson()"></textarea>
                </div>
            </form>
        </div>

        <!-- Billing Information section -->
        <div class="form-section" ng-if="cartSummary && !orderSubmitted">
            <h3>Billing Information</h3>

            <div class="form-check mb-3">
                <input class="form-check-input"
                       type="checkbox"
                       id="sameAsShipping"
                       ng-model="billingData.sameAsShipping"
                       ng-change="copyShippingToBilling(); updateOrderJson()">
                <label class="form-check-label" for="sameAsShipping">
                    Billing address same as shipping address
                </label>
            </div>

            <!-- (Optional) test card dropdown â€“ safe to leave, Angular handles it -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Test Credit Card (optional)</label>
                    <select class="form-select"
                            ng-model="selectedTestCard"
                            ng-change="fillTestCard()">
                        <option value="">Select a test credit card...</option>
                        <option value="visa">Visa: 1111 1111 1111 1111</option>
                        <option value="mastercard">MasterCard: 2222 2222 2222 2222</option>
                        <option value="amex">AmEx: 3333 333333 33333</option>
                        <option value="discover">Discover: 4444 4444 4444 4444</option>
                    </select>
                </div>
                <div class="col-md-6 d-flex align-items-end">
                    <div id="testCardDisplay" class="text-muted small">
                        {{testCardInfo}}
                    </div>
                </div>
            </div>

            <form name="billingForm" novalidate>
                <div class="mb-3">
                    <label class="form-label"><strong>Cardholder Name *</strong></label>
                    <input type="text"
                           class="form-control"
                           id="cardholderName"
                           name="cardholderName"
                           ng-model="billingData.cardholderName"
                           ng-blur="validateBillingField('cardholderName', billingData.cardholderName)"
                           ng-class="{'field-error': hasBillingError('cardholderName')}"
                           required>
                    <div class="error-message" ng-if="hasBillingError('cardholderName')">
                        {{billingValidationErrors.cardholderName}}
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label"><strong>Card Number *</strong></label>
                    <input type="text"
                           class="form-control"
                           id="cardNumber"
                           name="cardNumber"
                           ng-model="billingData.cardNumber"
                           ng-blur="validateBillingField('cardNumber', billingData.cardNumber)"
                           ng-class="{'field-error': hasBillingError('cardNumber')}"
                           required>
                    <div class="error-message" ng-if="hasBillingError('cardNumber')">
                        {{billingValidationErrors.cardNumber}}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label"><strong>Expiry Date *</strong></label>
                        <input type="text"
                               class="form-control"
                               id="expiryDate"
                               name="expiryDate"
                               placeholder="MM/YY"
                               maxlength="5"
                               ng-model="billingData.expiryDate"
                               ng-blur="validateBillingField('expiryDate', billingData.expiryDate)"
                               ng-class="{'field-error': hasBillingError('expiryDate')}"
                               required>
                        <div class="error-message" ng-if="hasBillingError('expiryDate')">
                            {{billingValidationErrors.expiryDate}}
                        </div>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label class="form-label"><strong>CVV *</strong></label>
                        <input type="text"
                               class="form-control"
                               id="cvv"
                               name="cvv"
                               maxlength="4"
                               ng-model="billingData.cvv"
                               ng-blur="validateBillingField('cvv', billingData.cvv)"
                               ng-class="{'field-error': hasBillingError('cvv')}"
                               required>
                        <div class="error-message" ng-if="hasBillingError('cvv')">
                            {{billingValidationErrors.cvv}}
                        </div>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label class="form-label"><strong>Billing ZIP Code *</strong></label>
                        <input type="text"
                               class="form-control"
                               id="billingZipCode"
                               name="billingZipCode"
                               maxlength="5"
                               ng-model="billingData.billingZipCode"
                               ng-blur="validateBillingField('billingZipCode', billingData.billingZipCode)"
                               ng-class="{'field-error': hasBillingError('billingZipCode')}"
                               required>
                        <div class="error-message" ng-if="hasBillingError('billingZipCode')">
                            {{billingValidationErrors.billingZipCode}}
                        </div>
                    </div>
                </div>

                <!-- Billing address fields (only if NOT same as shipping) -->
                <div ng-if="!billingData.sameAsShipping">
                    <div class="mb-3">
                        <label class="form-label"><strong>Billing Address *</strong></label>
                        <input type="text"
                               class="form-control"
                               id="billingAddress"
                               name="billingAddress"
                               ng-model="billingData.billingAddress"
                               ng-blur="validateBillingField('billingAddress', billingData.billingAddress)"
                               ng-class="{'field-error': hasBillingError('billingAddress')}"
                               required>
                        <div class="error-message" ng-if="hasBillingError('billingAddress')">
                            {{billingValidationErrors.billingAddress}}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><strong>Billing City *</strong></label>
                            <input type="text"
                                   class="form-control"
                                   id="billingCity"
                                   name="billingCity"
                                   ng-model="billingData.billingCity"
                                   ng-blur="validateBillingField('billingCity', billingData.billingCity)"
                                   ng-class="{'field-error': hasBillingError('billingCity')}"
                                   required>
                            <div class="error-message" ng-if="hasBillingError('billingCity')">
                                {{billingValidationErrors.billingCity}}
                            </div>
                        </div>

                        <div class="col-md-3 mb-3">
                            <label class="form-label"><strong>Billing State *</strong></label>
                            <input type="text"
                                   class="form-control"
                                   id="billingState"
                                   name="billingState"
                                   maxlength="2"
                                   ng-model="billingData.billingState"
                                   ng-blur="validateBillingField('billingState', billingData.billingState)"
                                   ng-class="{'field-error': hasBillingError('billingState')}"
                                   required>
                            <div class="error-message" ng-if="hasBillingError('billingState')">
                                {{billingValidationErrors.billingState}}
                            </div>
                        </div>

                        <div class="col-md-3 mb-3">
                            <label class="form-label"><strong>Billing ZIP Code *</strong></label>
                            <input type="text"
                                   class="form-control"
                                   id="billingZipCode2"
                                   name="billingZipCode2"
                                   maxlength="5"
                                   ng-model="billingData.billingZipCode"
                                   ng-blur="validateBillingField('billingZipCode', billingData.billingZipCode)"
                                   ng-class="{'field-error': hasBillingError('billingZipCode')}"
                                   required>
                            <div class="error-message" ng-if="hasBillingError('billingZipCode')">
                                {{billingValidationErrors.billingZipCode}}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="mt-3">
                    <button type="button" class="btn btn-secondary me-2" ng-click="resetForm()">
                        Reset
                    </button>
                    <button type="button" class="btn btn-primary" ng-click="submitOrder()">
                        Validate &amp; Submit Order
                    </button>
                </div>
            </form>
        </div>

        <!-- Order Complete message -->
        <div class="form-section" ng-if="orderSubmitted">
            <h3>âœ… Order Complete!</h3>
            <p>Your order has been successfully submitted. Below is the complete order JSON document.</p>
            <button class="btn btn-secondary" ng-click="resetForm()">Place New Order</button>
        </div>

        <!-- JSON Document Section -->
        <div class="form-section">
            <h4>Order JSON Document</h4>
            <div id="jsonOutput">{{finalOrderJson}}</div>
        </div>
    </main>

    <!-- Aside: Order summary on the right, same layout as other pages -->
    <aside ng-if="cartSummary && !orderSubmitted">
        <div class="form-section">
            <h3>Order Summary</h3>
            <p><strong>Items:</strong> {{cartSummary.itemCount}}</p>
            <p><strong>Subtotal:</strong> ${{cartSummary.totalPrice}}</p>
            <p><strong>Shipping:</strong> ${{calculateShipping()}}</p>
            <p><strong>Total:</strong> ${{calculateTotal()}}</p>
            <p ng-if="estimatedDelivery">
                <strong>Delivery:</strong> {{estimatedDelivery}}
            </p>

            <div class="mt-3"
                 ng-if="!hasValidationErrors() && shippingData.shippingCarrier && shippingData.shippingMethod">
                <p class="validation-success">
                    âœ“ Ready to submit after billing information
                </p>
            </div>
        </div>
    </aside>
</div>

<!-- Footer (same as index.html) -->
<footer>
    <p><a href="#">Terms of Use</a> | <a href="#">Cookie Policy</a> | <a href="#">Privacy Policy</a></p>
    <p>&copy; 2025 HiTech Store. All Rights Reserved.</p>
</footer>

</body>
</html>
